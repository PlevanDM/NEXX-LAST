!function(){"use strict";window.NEXXDatabase=new class{constructor(){this.masterDb=null,this.devices=null,this.prices=null,this.errorCodes=null,this.loaded=!1,this.loading=!1,this.listeners=[],this.source="unknown"}async loadAll(){if(!this.loaded&&!this.loading){this.loading=!0;try{const e=localStorage.getItem("nexx_db_version")||"3.2.2",o={credentials:"include"};const fc=async(n)=>{try{const r=await fetch("/api/d1/chunks/"+n+".json",o);if(r.ok){const d=await r.json();if(d!==null)return d}}catch{}return fetch("/data/chunks/"+n+".json?v="+e,o).then(r=>r.ok?r.json():("devices"===n?[]:"version"===n?{}:{}))};const[c,d,p,s,k,b,v]=await Promise.all([fc("config"),fc("devices"),fc("prices"),fc("services"),fc("knowledge"),fc("brands"),fc("version")]);this.source=v&&v.source==="d1"?"D1":"static",this.masterDb={config:c,devices:d,prices:p,services:s,knowledge:k,brands:b,version:v&&v.version},this.masterDb.version&&localStorage.setItem("nexx_db_version",this.masterDb.version),this.devices=Array.isArray(d)?d:[],this.prices=p||{},this.brands=b||{},this.services=s||{},this.contact=c&&c.contact||{};const i=k||{};this.errorCodes=i.errorCodes||{},this.logicBoards=i.logicBoards||{},this.icCompatibility=i.icCompatibility||{},this.cameraCompatibility=i.cameraCompatibility||{},this.measurements=i.measurements||{},this.keyCombinations=i.keyCombinations||{},this.regionalCodes=i.regionalCodes||{},this.repairKnowledge=i.repairKnowledge||{},this.articleSearchIndex=i.articleSearchIndex||{},this.loaded=!0,this.loading=!1,this.notifyListeners(),console.log("✅ NEXX Database loaded ("+this.source+"):",{version:this.masterDb.version,devices:this.devices.length,prices:Object.keys(this.prices).length,knowledge:Object.keys(i).length})}catch(e){throw this.loading=!1,console.error("❌ Failed to load database:",e),e}}}getBrands(e="phone"){return this.masterDb&&this.masterDb.brands?.[e]||[]}getDevicesByBrand(e,s=null){if(!this.devices)return[];const i=e.toLowerCase(),t=s?s.toLowerCase():null;return this.devices.filter(e=>{const s=(e.name||"").toLowerCase(),r=(e.category||"").toLowerCase();let n=!1;if(n="iphone"===i||"apple"===i?s.includes("iphone")||s.includes("ipad")||s.includes("macbook")||s.includes("imac")||r.includes("iphone")||r.includes("ipad")||r.includes("macbook"):"samsung"===i?s.includes("samsung")||s.includes("galaxy")||r.includes("samsung")||r.includes("galaxy"):"xiaomi"===i?s.includes("xiaomi")||s.includes("redmi")||s.includes("poco")||r.includes("xiaomi"):"huawei"===i?s.includes("huawei")||s.includes("honor")||r.includes("huawei")||r.includes("honor"):s.includes(i)||r.includes(i),!n)return!1;if(t){if("iphone"===t||"phone"===t)return s.includes("iphone")&&!s.includes("ipad")&&!s.includes("macbook")&&!s.includes("watch");if("ipad"===t||"tablet"===t)return s.includes("ipad")||s.includes("tablet")||r.includes("ipad")||r.includes("tablet");if("macbook"===t||"laptop"===t)return s.includes("macbook")||s.includes("mac")||r.includes("macbook")||r.includes("laptop");if("watch"===t)return s.includes("watch")||r.includes("watch")}return!0})}getPrice(e,s){if(!this.masterDb)return null;const i=this.masterDb.prices?.commonRepairs?.[s]?.[e];return i||null}getDevicePrice(e,s){if(!this.devices||!e||!s)return null;const i=[s,{screen:"display",charging:"charging_port",camera:"rear_camera",motherboard:"logic_board"}[s]].filter(Boolean);try{const s=this.devices.find(s=>{const i=(s.name||"").toLowerCase(),t=(e||"").toLowerCase();return i.includes(t)||t.includes(i)});if(!s)return null;if(s.service_prices_ron&&"object"==typeof s.service_prices_ron)for(const e of i){const i=s.service_prices_ron[e];if("number"==typeof i&&i>0)return i}if(s.official_service_prices&&"object"==typeof s.official_service_prices){const e=4.5;for(const t of i){const i=s.official_service_prices[t];if("number"==typeof i&&i>0)return Math.round(i*e)}}if(this.masterDb?.prices?.devices){const s=this.masterDb.prices.devices[e];if(s)for(const e of i)if(s[e])return s[e]}const t=(s.category||"phone").toLowerCase();if(this.masterDb?.prices?.commonRepairs)for(const e of i){const s=this.masterDb.prices.commonRepairs[e]?.[t];if("number"==typeof s&&s>0)return s}return null}catch(e){return console.error("Error in getDevicePrice:",e),null}}getServiceInfo(e){return this.masterDb&&this.masterDb.services?.[e]||null}searchDevice(e){if(!this.devices||!e)return[];const s=e.toLowerCase();return this.devices.filter(e=>e.name?.toLowerCase().includes(s)||e.model?.toLowerCase().includes(s)||e.category?.toLowerCase().includes(s)).slice(0,20)}getPopularDevices(e=10){return this.devices?this.devices.filter(e=>e.year>=2020).sort((e,s)=>s.year-e.year).slice(0,e):[]}getAllRepairTypes(){return this.masterDb?Object.keys(this.masterDb.services||{}):[]}subscribe(e){return this.listeners.push(e),this.loaded&&e(this),()=>{this.listeners=this.listeners.filter(s=>s!==e)}}notifyListeners(){this.listeners.forEach(e=>e(this))}getContact(){return this.masterDb?.contact||{}}getSEO(){return this.masterDb?.seo||{}}isRemonlineEnabled(){return this.masterDb?.config?.remonlineEnabled||!1}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.NEXXDatabase.loadAll()}):window.NEXXDatabase.loadAll(),console.log("✅ NEXX Database Manager initialized")}();